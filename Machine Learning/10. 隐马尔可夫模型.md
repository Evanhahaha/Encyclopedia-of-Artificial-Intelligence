# 隐马尔可夫模型的基本概念

 ## 隐马尔可夫模型的定义

Q是所有可能的状态的集合：
$$
Q = \{q_1,q_2,...,q_N\}
$$
V是所有可能的观测的集合：
$$
V= \{v_1,v_2,...,v_m\}
$$
N是可能的状态数，M是可能的观测数。

I是长度为T的状态序列。
$$
I=(i_1,i_2,....,i_T)
$$
O是对应的观测序列。
$$
Q=(o_1,o_2,....,o_T)
$$
A是状态转移概率矩阵：
$$
A = [a_{ij}]_{M\times N}
$$
其中：
$$
a_{ij}=P(i_{t+1}=q_j|i_t=q_i),i=1,2,...,N;j=1,2,...,N
$$
B是观测概率矩阵：
$$
B=[b_j(k)]_{N \times M}
$$
其中：
$$
b_j(k)=P(o_t=v_k|i_t=q_j)，k=1,2,...,M;j=1,2,...,M
$$


$\pi$是初始状态概率向量：
$$
\pi = (\pi_i)\\
\pi_i=P(i_1=q_i),i=1,2,...N\\
是时刻t=1处于状态q_i的概率
$$
隐马尔可夫模型
$$
\lambda=(A,B,\pi)
$$
**两个基本假设**

1. 齐次马尔可夫行假设：即假设隐藏的马尔可夫链在任意时刻t的状态只依赖于其前一时刻的状态，与其他时刻的状态及观测无关，也与时刻t无关。
2. 观测独立性假设，即假设任意时刻的观测值的观测值只依赖于该时刻的马尔可夫链的状态，与其他观测及状态无关。

## 隐马尔可夫模型的三个基本问题

1. 概率计算问题：

$$
给定模型\lambda=(A,B,\pi)和观测序列O=(o_1,o_2,...,o_T)，
计算在模型\lambda下观测序列O出现的概率P(O|\lambda)
$$

2. 学习问题：

$$
已知观测序列O=(o_1,o_2,...,o_T)，估计模型\lambda=(A,B,\pi,)参数，使得该模型下观测序列概率P(O|\lambda)最大，即用极大似然估计的方法估计参数
$$

3. 预测问题：
   $$
   已知模型\lambda=(A,B,\pi)和观测序列O=(o_1,o_2,...,o_T)，求对给定观测序列条件概率P(I|O)最大状态序列I=(i_1,i_2,...,i_T)，即给定观测序列，求最有可能的对应的状态序列。
   $$



# 概率计算算法

## 直接计算法

给定模型$\lambda=(A,B,\pi)$和观测序列$O=(o_1,o_2,...,o_T)$，计算在模型$\lambda$下观测序列$O$出现的概率P$(O|\lambda)$

状态序列I=(i_1,i_2,...,i_T)的概率：
$$
P(I|\lambda)=\pi_{i_1}a_{i_1i_2}a_{i_2i_3}...a_{i_{T-1}i_T}
$$
对固定状态序列，得到对应的观测蓄力的概率：
$$
P(O|I,\lambda)=b_{i_1}(o_1)b_{i_2}(o_2)....b_{i_T}(o_T)
$$
O和I同时出现的联合概率为：
$$
P(O,I|\lambda)=\pi_{i_1}b_{i_1}(o_1)a_{i_1i_2}b_{i_2}(o_2)a_{i_2i_3}...a_{i_{T-1}i_T}b_{i_T}(o_T)
$$
对所有的可能的状态序列I求和：
$$
P(O|\lambda) = \sum_I P(O|I,\lambda)P(I|\lambda)
$$
计算量很大，$O(TN^T)$阶

## 前向算法

给定隐马尔可夫模型$\lambda$，定义到时刻$t$部分观测序列为$o_1,o_2,...,o_t$，且状态为$q_i$的概率为前向概率，记作：
$$
\alpha_t(i)=P(o_1,o_2,....,o_t,i_t=q_i|\lambda)
$$
初值：
$$
\alpha_1=\pi_ib_i(o_1),i=1,2,...,N
$$
递推：
$$
\alpha_{t+1}(i)=[\sum_{j=1}^{N}\alpha_t(j)a_{ji}]b_i(o_{t+1})
$$
终止：
$$
P(O|\lambda)=\sum_{i=1}^N\alpha_T(i)
$$

## 后向算法

给定隐马尔可夫模型$\lambda$，定义在时刻$t$状态为$q_i$的条件下，从t+1到T的部分观测序列为$o_{t+1},o_{t+2},...o_T$的概率为后向概率，记作：
$$
\beta_t(i)=P(o_{t+1},o_{t+2},...,o_T|)
$$
Step1:
$$
\beta_T(i)=1，i=1,2,...,N
$$
Step2 $t=T-1,T-2,...,1$：
$$
\beta_t(i)=\sum_{j=1}^Na_{ij}b_j(o_{t+1})\beta_{t+1}(j),i=1,2,...,N
$$
Step3：
$$
P(O|\lambda)=\sum_{i=1}^N\pi_ibi(o_1)\beta_1(i)
$$

## 一些概率与期望值的计算

1. 给定模型$\lambda$和观测$O$，在时刻$t$处于状态$q_i$的概率：
   $$
   \gamma_t(i)=P(i_t=q_i|O,\lambda) \\
   =\frac{\alpha_t(i)\beta_t(i)}{\sum_{j=1}^N\alpha_t(j)\beta_t(j)}
   $$

2. 给定模型$\lambda和观测$O$，在时刻$t$处于状态$q_i$且在时刻$t+1$处于状态$q_j$的概率，记作：

$$
\zeta_t(i,j)=\frac{\alpha_t(i)\beta_{t+1}(j)a_{ij}b_j(o_{t+1})}{\sum_{i=1}^N\sum_{j=1}^N\alpha_t(i)\beta_t(j)a_{ij}b_j(o_{t+1})}
$$

3. 概率值求和：

(1)在观测O在状态i出现的期望值：
$$
\sum_{t=1}^T\gamma_t(i)
$$
(2)在观测O下由状态i转移的期望值
$$
\sum_{t=1}^{T-1}\gamma_t(i)
$$


































